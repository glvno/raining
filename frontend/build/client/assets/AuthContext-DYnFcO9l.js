import{a as i,q as p}from"./chunk-JMJ3UQ3L-D46zko18.js";const n="raining_auth_token",h="/api",y=i.createContext(void 0);function T({children:f}){const[u,a]=i.useState(null),[d,l]=i.useState(null),[w,r]=i.useState(!0),[E,c]=i.useState(null),S=!!u&&!!d;i.useEffect(()=>{const o=localStorage.getItem(n);o?(a(o),m(o)):r(!1)},[]);const m=async o=>{const s=o||u;if(!s){r(!1);return}try{const e=await fetch(`${h}/me`,{headers:{Authorization:`Bearer ${s}`}});if(e.ok){const t=await e.json();l(t.user),a(s),localStorage.setItem(n,s)}else a(null),l(null),localStorage.removeItem(n)}catch{c("Failed to verify authentication"),a(null),l(null),localStorage.removeItem(n)}finally{r(!1)}},k={token:u,user:d,isAuthenticated:S,isLoading:w,error:E,login:async(o,s)=>{r(!0),c(null);try{const e=await fetch(`${h}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:s})});if(!e.ok){const g=await e.json();throw new Error(g.error||"Login failed")}const t=await e.json();a(t.token),l(t.user),localStorage.setItem(n,t.token)}catch(e){const t=e instanceof Error?e.message:"Login failed";throw c(t),e}finally{r(!1)}},register:async(o,s)=>{r(!0),c(null);try{const e=await fetch(`${h}/users/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:s})});if(!e.ok){const g=await e.json();throw new Error(g.error||"Registration failed")}const t=await e.json();a(t.token),l(t.user),localStorage.setItem(n,t.token)}catch(e){const t=e instanceof Error?e.message:"Registration failed";throw c(t),e}finally{r(!1)}},logout:async()=>{r(!0);try{u&&await fetch(`${h}/users/logout`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}})}catch(o){console.error("Logout API call failed:",o)}finally{a(null),l(null),localStorage.removeItem(n),r(!1)}},checkAuth:()=>m(),clearError:()=>c(null)};return p.jsx(y.Provider,{value:k,children:f})}function P(){const f=i.useContext(y);if(f===void 0)throw new Error("useAuth must be used within an AuthProvider");return f}export{T as A,P as u};
